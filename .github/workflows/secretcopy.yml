name: Sync Secrets

on:
  push:
    branches:
      - secretcopy  # Or specify the branch you want to trigger this workflow

jobs:
  sync-secrets:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v2

      - name: Sync Secrets
        env:
          SOURCE_REPO: 'neeratikrishna15/databricksencryption'
          TARGET_REPO: 'neeratikrishna15/databricksactions'
          SOURCE_TOKEN: ${{ secrets.SOURCE_TOKEN }}
          TARGET_TOKEN: ${{ secrets.TARGET_TOKEN }}
          SECRET_NAME: 'COPYTEST'
          SECRET_VALUE: ${{ secrets.SECRET_NAME }}  # Access the secret value
        run: |
          
          SOURCE_SECRET=$(curl -X GET -H "Authorization: token $SOURCE_TOKEN" \
                          "https://api.github.com/repos/$SOURCE_REPO/actions/secrets/$SECRET_NAME" )
          echo $SOURCE_SECRET
          
          curl -X PUT -H "Authorization: token $TARGET_TOKEN" \
               -H "Accept: application/vnd.github.v3+json" \
               -d "$SOURCE_SECRET" \
               "https://api.github.com/repos/$TARGET_REPO/actions/secrets/$SECRET_NAME"
